<% style ||= :conversation %>
<%= form_with(model: conversation.persisted?  ? [:account, conversation, message] : [:account, conversation.send(BulletTrain::Conversations.parent_association), conversation], remote: true, class: 'new-message-form', data: {controller: "form", action: "submit->form#stripTrix turbo:submit-end->form#resetOnSuccess turbo:submit-end->reply#cancel"}) do |form| %>

  <%= form.hidden_field :style, value: style %>
  <%= render 'shared/forms/errors', form: form %>
  <% if conversation.persisted? %>
    <%= render 'account/conversations/messages/field', form: form, message: message %>
  <% else %>
    <%= form.hidden_field :subject_id %>
    <%= form.hidden_field :subject_class %>

    <%= form.fields_for :messages do |message_form| %>
      <%= render 'account/conversations/messages/field', form: message_form, message: message %>
    <% end %>
  <% end %>
<% end %>
